<!DOCTYPE html>
<html>
<head>
  	<title>Management</title>
	


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<script src="js/Management.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places"></script>
	<link rel="stylesheet" href="css/style.css">
</head>
<body>

	<h1 style="display:block; text-align:center;" >Beheer pagina</h1>
	<p style="display:block; text-align:center;" id="login" > U bent ingelogd als </p>
  	<p align="center">Welkom op de beheer pagina, hier kunnen races bekeken, aangemaakt, gewijzigd en verwijderd worden.</p>

  	<div data-role="tabs" id="tabs">
	  <div data-role="navbar">
	    <ul>
	      <li><a href="#one" data-ajax="false">Races</a></li>
	      <li><a href="#two" data-ajax="false">Aanmaken</a></li>
	      <li><a href="crud/read.html" data-ajax="false">Aanpassen</a></li>
	      <li><a href="#four" data-ajax="false">Verwijderen</a></li>
	    </ul>
	  </div>
	  <div id="two" class="ui-body-d ui-content">
	    <ul id="listview" data-role="listview" data-inset="true">
	       
	    </ul>
	  </div>
	  <div id="one">
	    <p><input type="text" id="racename" name="name" value="" placeholder="Naam"></p>
        <p><input type="text" id="racedescrip" name="description" value="" placeholder="Beschrijving"></p>
         <p><input type="text" id="racestartdate" name="startdate" value="" placeholder="Start datum (YYYY-mm-dd)"></p>
        <select id="racestatus">
        	<option value="Open">Open</option>
        	<option value="Closed">Closed</option>
        </select>
        <h3 style="text-align:center; background-color: #D0F5F3"> Huidige Waypoints</h3>


        <ul id="waypoints" data-role="listview" data-inset="true">
	      
	    </ul>
	   	<h3 style="text-align:center; background-color: #D0F5F3"> Zoeken naar Waypoints</h3>

	   	<p>
	   		<input type="text" id="pac-input" name="name" value="" placeholder="Zoekterm">
	   	</p>


	   	<h3 style="text-align:center; background-color: #D0F5F3"> Resultaten</h3>
        <ul id="resultpoints" data-role="listview" data-inset="true">
	    </ul>

        <p class="submit"><input id="saverace" type="submit" name="commit" value="Voeg race toe"></p>
	  </div>

	  <div id="four">
	  	<h3>Race verwijderen</h3>
	  	<ul id="listviewremove" data-role="listview" data-inset="true">
	       
	    </ul>
	  </div>
	</div>


	<div id="dialog-confirm">Wanneer je de race verwijderd, zullen alle waypoints met daarbij de bijbehorende users verwijderd worden</div>


</body>

<script type="text/javascript">

	$(document).ready(function()
	{

		var user = localStorage.getItem("user");
		if(user != null)
		{
			$("#login").append(user.fullName);
		}
		//section Races Read
		getAllRaces(function(races)
		{
			for(var race in races)
			{
				if(races[race].status == "Open")
				{
					$("#listview").append('<li>' + races[race].name + ' - ' + races[race].description + ' <span style="float:right;"> Waypoints : ' + races[race].waypoints.length + ' |  Status : ' + races[race].status + '</span></li>');
					$("#listviewremove").append('<li><a>' + races[race].name + ' - ' + races[race].description + ' <span style="float:right;"> Waypoints : ' + races[race].waypoints.length + ' |  Status : ' + races[race].status + '</span></a></li>');
				}
			}
			$("#listview").listview("refresh");
			$("#listviewremove").listview("refresh");
		});
		//---------------------
		//section Races Create
		getGoogleMapsGeo();
		
		$(document.body).on('click', '#resultpoints li a' ,function(){

			var name = $(this).text();
			var placeid = $(this).attr("place-id");
			var lng = $(this).attr("lng");
			var lat = $(this).attr("lat");

			$("#waypoints").append('<li><a  lat="' + lat+ '" lng="' + lng+ '" place-id="' + placeid + '">' + name + '</a></li>');
			$("#waypoints").listview("refresh");
			
		});
		
		$("#saverace").on("click", function()
		{
			saveRace();
		});

		});

</script>

</html>